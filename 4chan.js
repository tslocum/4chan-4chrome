var h=true,i=null,n=false;function insertAfter(b,d){var a=d.parentNode;a.lastchild==d?a.appendChild(b):a.insertBefore(b,d.nextSibling)}function getElementsByAttribute(b,d){for(var a=[],c=document.getElementsByTagName("*"),e=0;e<c.length;e+=1)c[e].hasAttribute(b)&&c[e].getAttribute(b)==d&&a.push(c[e]);return a}
function watchThread(b){chrome.extension.sendRequest({reqtype:"get-watchedthreads"},function(d){watchedthreads=d;d=n;for(var a=0;a<watchedthreads.length;a++)if(watchedthreads[a][0]==b[0]&&watchedthreads[a][1]==b[1])d=h;if(d)alert("Thread No."+b[1]+" is already being watched.");else{watchedthreads.push(b);storeWatchedThreads();alert("Added thread No."+b[1]+" to watch list.")}refreshThreadWatcher()})}
function unwatchThread(b,d){chrome.extension.sendRequest({reqtype:"get-watchedthreads"},function(a){watchedthreads=a;for(a=0;a<watchedthreads.length;a++)watchedthreads[a][0]==b&&watchedthreads[a][1]==d&&watchedthreads.splice(a,1);storeWatchedThreads();refreshThreadWatcher()})}function storeWatchedThreads(){chrome.extension.sendRequest({reqtype:"set-watchedthreads",watchedthreads:watchedthreads})}
function updateWatchedThreadNote(b,d,a){chrome.extension.sendRequest({reqtype:"get-watchedthreads"},function(c){watchedthreads=c;for(c=0;c<watchedthreads.length;c++)if(watchedthreads[c][0]==d&&watchedthreads[c][1]==a)watchedthreads[c][4]=b.replace('"',"").replace("<","").replace(">","");storeWatchedThreads()})}function refreshThreadWatcherCache(){chrome.extension.sendRequest({reqtype:"get-watchedthreads"},function(b){watchedthreads=b;refreshThreadWatcher()})}
function refreshThreadWatcher(){var b=window.location.href.match(/.*\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i);if(b!=i){var d=b[1];watchboxtable=document.getElementById("watchboxtable");watchboxtable.innerHTML='<tr><td class="postblock" style="border-right: 0px none;">No.</td><td class="postblock" style="border-left: 0px none;border-right: 0px none;">Subject</td><td class="postblock" style="border-left: 0px none;border-right: 0px none;">Author</td><td class="postblock" style="border-left: 0px none;border-right: 0px none;">Note</td><td class="postblock" style="border-left: 0px none;">&nbsp;</td></tr>';
b=[];for(var a=0;a<watchedthreads.length;a++)watchedthreads[a][0]==d&&b.push(watchedthreads[a]);if(b.length==0){d=document.createElement("tr");d.innerHTML='<td colspan="5" align="center">No watched threads.</td>';watchboxtable.appendChild(d)}else for(a=0;a<b.length;a++){d=document.createElement("tr");d.innerHTML='<td style="padding-left: 3px;padding-right: 3px;">'+b[a][1]+'</td><td class="filetitle" style="padding-left: 3px;padding-right: 3px;">'+b[a][2]+'</td><td class="postername" style="padding-left: 3px;padding-right: 3px;">'+
b[a][3]+'</td><td style="padding-left: 3px;padding-right: 3px;"><input type="text" placeholder="Enter a note" size="12" value="'+b[a][4]+'" id="note'+b[a][0]+b[a][1]+'"></td><td style="padding-left: 3px;padding-right: 3px;"><small>[<a href="/'+b[a][0]+"/res/"+b[a][1]+'">view</a>] [<a href="#" id="delete'+b[a][0]+b[a][1]+'">delete</a>]</small></td>';watchboxtable.appendChild(d);d=document.getElementById("note"+b[a][0]+b[a][1]);d.setAttribute("board",b[a][0]);d.setAttribute("threadid",b[a][1]);d.onchange=
function(){updateWatchedThreadNote(this.value,this.getAttribute("board"),this.getAttribute("threadid"))};d.onkeyup=function(){updateWatchedThreadNote(this.value,this.getAttribute("board"),this.getAttribute("threadid"))};d=document.getElementById("delete"+b[a][0]+b[a][1]);d.setAttribute("board",b[a][0]);d.setAttribute("threadid",b[a][1]);d.addEventListener("click",function(){window.confirm("Stop watching thread No."+this.getAttribute("threadid")+"?")&&unwatchThread(this.getAttribute("board"),this.getAttribute("threadid"))},
n)}}}function hideThread(b){chrome.extension.sendRequest({reqtype:"get-hiddenthreads"},function(d){hiddenthreads=d;d=window.location.href.match(/.*\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i);if(d!=i){for(var a=n,c=0;c<hiddenthreads.length;c++)if(hiddenthreads[c][0]==d[1]&&hiddenthreads[c][1]==b)a=h;if(!a){hiddenthreads.push([d[1],b]);storeHiddenThreads()}}})}
function unhideThread(b){chrome.extension.sendRequest({reqtype:"get-hiddenthreads"},function(d){hiddenthreads=d;d=window.location.href.match(/.*\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i);if(d!=i){for(var a=0;a<hiddenthreads.length;a++)hiddenthreads[a][0]==d[1]&&hiddenthreads[a][1]==b&&hiddenthreads.splice(a,1);storeHiddenThreads()}})}function storeHiddenThreads(){chrome.extension.sendRequest({reqtype:"set-hiddenthreads",hiddenthreads:hiddenthreads})}
function quickReplyBox(b,d){var a=document.createElement("div"),c="qr"+Math.floor(Math.random()*1E3);a.id=c;a.style.borderTop="0px none";a.style.borderBottom="1px solid #CCCCCC";a.style.borderLeft="1px solid #CCCCCC";a.style.borderRight="1px solid #CCCCCC";a.innerHTML='<span title="Close" style="float: right;cursor: pointer;font-weight: bold;font-size: 1.1em;padding: 1px;" onclick="javascript:var qr=document.getElementById(\''+c+'\');qr.parentNode.removeChild(qr);return false;">&nbsp;X&nbsp;</span><div style="text-align: center;cursor: move;padding: 1px;margin-bottom: 10px;" class="postblock">Quick Reply (#'+
b+")</div>"+postarea;if(enable_quickreplyiframe)a.innerHTML+='<iframe id="'+c+'iframe" src="about:blank" style="display: none;min-width:100px;height:50px;margin:0px;padding:0px;"></iframe>';a.className="reply";a.style.margin="0";a.style.padding="0";a.style.position="absolute";for(var e=d.offsetLeft,f=d.offsetTop,g=d;g.offsetParent;)if(g==document.getElementsByTagName("body")[0])break;else{e+=g.offsetParent.offsetLeft;f+=g.offsetParent.offsetTop;g=g.offsetParent}a.style.left=e;a.style.top=f;e=a.getElementsByTagName("table");
for(f=0;f<e.length;f++)e[f].width=="100%"&&e[f].parentNode.removeChild(e[f]);e=a.getElementsByTagName("div");for(f=0;f<e.length;f++)e[f].className!="postblock"&&e[f].id!="recaptcha_area"&&e[f].id!="recaptcha_image"&&e[f].innerHTML.indexOf("recaptcha")==-1&&e[f].parentNode.removeChild(e[f]);e=a.getElementsByTagName("tr");for(f=0;f<e.length;f++)e[f].innerHTML=='<td></td><td colspan="2">\n</td>'&&e[f].parentNode.removeChild(e[f]);if(enable_quickreplyiframe){a.getElementsByTagName("form")[0].id=c+"form";
if(a.getElementsByTagName("form")[0].action.search("#")!=-1)a.getElementsByTagName("form")[0].action=a.getElementsByTagName("form")[0].action.split("#")[0];e=a.getElementsByTagName("input");for(f=0;f<e.length;f++)if(e[f].value=="Submit"){e[f].setAttribute("submitted","false");e[f].setAttribute("qrbid",c);e[f].addEventListener("click",function(){document.getElementById(this.getAttribute("qrbid")+"iframe").style.display="block";document.getElementById(this.getAttribute("qrbid")+"form").submit()},n)}a.getElementsByTagName("form")[0].setAttribute("target",
c+"iframe")}insertAfter(a,d);firstinput=a.getElementsByTagName("input")[0];c=document.createElement("input");c.name="resto";c.value=b;c.type="hidden";insertAfter(c,firstinput);autoFillPostBox(a);return a}
function replaceRefLinksWithQuickReply(b,d){if(enable_quickreply||enable_report||enable_sage){b||(b=document);for(var a=b.getElementsByTagName("a"),c=0;c<a.length;c++){var e=i,f=d,g=a[c].href.match(/.*quote\(\'([0-9]+)\'\)/i);if(g!=i){e=g[1];if(!f){g=window.location.href.match(/.*\/res\/([0-9]+).*/i);if(g!=i)f=g[1]}if(a[c].innerText.search("X")!=-1)a[c].innerText=e}else if(a[c].className=="quotejs"){g=a[c].href.match(/[.*]?res\/([0-9]+)(?:\.html)?\#q([0-9]+)/i);if(g!=i){f=g[1];e=g[2];if(a[c].innerText.search("X")!=
-1)a[c].innerText=e}}if(enable_quickreply&&e&&f&&a[c].href!="javascript:return false;"){a[c].setAttribute("postID",e);a[c].setAttribute("threadID",f);a[c].setAttribute("thisElement",a[c]);a[c].setAttribute("isQuickReply","true");enable_quickreply&&a[c].addEventListener("click",function(){var k=this.getAttribute("threadID"),l=this.getAttribute("postID");qrb=quickReplyBox(k,this.parentNode);k=qrb.getElementsByTagName("textarea");for(var j=0;j<k.length;j++)k[j].value=k[j].value!=""?">>"+l+"\n\n"+k[j].value:
">>"+l+"\n"},n);a[c].href="javascript:false;"}if(enable_report&&e&&a[c].getAttribute("processed")==i){if(f=document.location.href.match(/.*\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i)){g=document.createElement("a");g.href="javascript:reppop('http://sys.4chan.org/"+f[1]+"/imgboard.php?mode=report&no="+e+"');return false;";g.style.textDecoration="none";g.innerHTML=' <img border="0" src="'+chrome.extension.getURL("button_report.png")+'" title="Report Post">';insertAfter(g,a[c])}a[c].setAttribute("processed",
"true")}if(enable_sage&&a[c].href.toLowerCase()=="mailto:sage"&&a[c].getAttribute("processed")==i){a[c].innerHTML="&nbsp;"+a[c].innerHTML+"&nbsp;";a[c].style.textDecoration="none";a[c].style.background="url('"+chrome.extension.getURL("sage.png")+"')";a[c].style.backgroundRepeat="repeat";a[c].setAttribute("processed","true")}}}}
function setExpandImageAttributes(b){if(enable_expandimages){var d=b.href.match(/.*images\.4chan\.org\/.*\/src\/(.*)/i);if(d==i)d=b.href.match(/.*4chanarchive\.org\/images\/(.*)/i);if(d==i)d=b.href.match(/.*inb4\.im\/.*\/src\/(.*)/i);if(d)if(b.innerHTML.substring(0,4)=="<img"){if(b.getAttribute("expanded")==i){b.setAttribute("expanded","false");b.setAttribute("expandImage",expandImage);b.setAttribute("expandOriginalHTML",b.innerHTML);b.setAttribute("onClick","javascript:return false;");img=b.getElementsByTagName("img")[0];
b.setAttribute("thumbSRC",img.getAttribute("src"));b.setAttribute("thumbWidth",img.getAttribute("width"));b.setAttribute("thumbHeight",img.getAttribute("height"));b.target="_self";b.addEventListener("click",function(a){if(a.which==2)window.open(this.getAttribute("expandImage"),"_blank");else if(a.which==1)if(this.getAttribute("expanded")!="true"){this.innerHTML='<img style="border: 1px dashed black;min-width: '+this.getAttribute("thumbWidth")+"px;min-height: "+this.getAttribute("thumbHeight")+'px;" src="'+
this.getAttribute("expandImage")+'" border="0" align="left" hspace="20">';this.setAttribute("expanded","true")}else{this.innerHTML=this.getAttribute("expandOriginalHTML");this.setAttribute("expanded","false")}},n);if(expand_all_thumbs){d=document.createEvent("MouseEvents");d.initMouseEvent("click",h,h,window,0,0,0,0,0,n,n,n,n,0,i);b.dispatchEvent(d)}}}else expandImage=b.href}}
function setPostAttributes(b,d){for(var a=b.getElementsByTagName("a"),c=0;c<a.length;c++){var e=a[c].href.match(/.*\/[0-9]+(?:\.html)?#([0-9]+)/i);if(e==i)e=a[c].href.match(/\#([0-9]+)/i);if(e!=i)if(a[c].innerHTML=="No."){b.setAttribute("postID",e[1]);b.className="4c4c_reply"}else{if(enable_preview&&a[c].getAttribute("refID")==i)if(a[c].innerHTML.match(/^\&gt\;\&gt\;[0-9]+/i)!=i){a[c].setAttribute("refID",e[1]);a[c].addEventListener("mousemove",function(f){var g=document.getElementById("ref"+this.getAttribute("refID"));
if(!g){g=document.createElement("div");g.id="ref"+this.getAttribute("refID");g.className="reply";g.style.margin="0";g.style.padding="0";g.style.position="absolute";for(var k=window.location.href.search("4chan.org")==-1?document.getElementsByTagName("table"):document.getElementsByClassName("4c4c_reply"),l=0;l<k.length;l++){var j=k[l].getAttribute("postID");if(j&&j==this.getAttribute("refID")){g.innerHTML=k[l].innerHTML;if(k[l].getAttribute("op")=="true"){g.className="postblock";g.innerHTML='<div style="position: absolute;right: 0px;top: 0px;font-size: 1.5em;margin: 0px;padding: 1px;" class="unkfunc">OP</div>'+
g.innerHTML}}}insertAfter(g,this)}g.style.left=f.clientX+document.body.scrollLeft+document.documentElement.scrollLeft+25;g.style.top=f.clientY+document.body.scrollTop+document.documentElement.scrollTop+10},n);a[c].addEventListener("mouseout",function(){var f=document.getElementById("ref"+this.getAttribute("refID"));f&&f.parentNode.removeChild(f)},n)}}else d&&setExpandImageAttributes(a[c])}}
function processExpandTables(b,d,a,c,e,f,g){g||(g=[]);if(f&&f.length>0){var k=f.shift();if(k.width!="100%"&&k.cellpadding!="0"&&k.align!="right")b.innerHTML+="<table>"+k.innerHTML+"</table>"}if(f&&f.length>0)setTimeout(processExpandTables,1,b,d,a,c,e,f,g);else{d.style.display="none";d=document.getElementsByClassName("4c4c_reply");for(f=0;f<d.length;f++)if(d[f].getAttribute("threadID")==a)d[f].style.display="none";d=b.getElementsByTagName("table");for(f=0;f<d.length;f++)setPostAttributes(d[f],h);replaceRefLinksWithQuickReply(b,
a);d=document.getElementsByTagName("span");for(f=0;f<d.length;f++)d[f].id=="omittedposts"+a&&insertAfter(b,d[f]);c.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_retract.png")+'" title="Retract">&nbsp;';e.innerHTML="Thread No."+a+" expanded."}}
function autoFillPostBox(b){b||(b=document);for(var d=b.getElementsByTagName("input"),a=0;a<d.length;a++)if(d[a].name=="name"){if(default_name!="")d[a].value=default_name}else if(d[a].name=="email"){if(default_email!="")d[a].value=default_email}else if(d[a].name=="sub"){if(default_subject!="")d[a].value=default_subject}else if(d[a].name=="pwd")if(default_password!="")d[a].value=default_password;d=b.getElementsByTagName("textarea");for(a=0;a<d.length;a++)if(d[a].name=="com")if(d[a].value==""&&default_comment!=
"")d[a].value=default_comment}function processLatestRepliesLoop(b,d){var a=n;if(b&&b.length>0){a=b.shift();if(a.getAttribute("special")!=i||a.getAttribute("postID")>lastreply.getAttribute("postID")){replaceRefLinksWithQuickReply(a);insertAfter(a,lastreply);lastreply=a;lastreplyid=lastreply.getAttribute("postID")}}if(b&&b.length>0)setTimeout(processLatestRepliesLoop,10,b,d);else last_modified=d}
function fetchLatestPosts(){var b=n,d=window.location.href.match(/.*\/res\/([0-9]+).*/i);if(d!=i)b=d[1];if(b){var a=new XMLHttpRequest;a.open("HEAD",b,h);a.send();a.threadID=b;a.onreadystatechange=function(){if(a.readyState==4)if(last_modified&&(a.status==404||a.getResponseHeader("Last-Modified")!=last_modified)){var c=new XMLHttpRequest;c.open("GET",a.threadID,h);c.send();c.threadID=a.threadID;c.onreadystatechange=function(){var e=[];e.length=0;if(c.status==404){if(document.forms[1].getAttribute("has404d")==
"false"){document.forms[1].setAttribute("has404d","true");var f=document.createElement("span");f.setAttribute("special","true");f.innerHTML="This thread has 404'd";f.style.color="red";f.style.fontSize="2.0em";e.push(f)}}else if(c.status==200){f=document.createElement("span");f.innerHTML=c.responseText;f=f.getElementsByTagName("table");for(var g=0;g<f.length;g++){setPostAttributes(f[g],h);f[g].getAttribute("postID")!=i&&f[g].getAttribute("postID")>lastreplyid&&e.push(f[g])}}if(e.length>0){last_modified=
n;f=c.getResponseHeader("Last-Modified");if(!lastreply){g=document.forms[1].getElementsByClassName("4c4c_reply");for(var k=0;k<g.length;k++)if(g[k].getAttribute("postID")!=i&&g[k].getAttribute("op")==i){lastreply=g[k];lastreplyid=lastreply.getAttribute("postID")}}lastreply||(lastreply=document.forms[1].getElementsByTagName("blockquote")[0]);processLatestRepliesLoop(e,f)}}}};document.forms[1].getAttribute("has404d")=="false"&&setTimeout(fetchLatestPosts,1E4)}}threads=[];delform=i;lastreply=n;
lastreplyid=0;last_modified=document.lastModified;expand_all_thumbs=created_op_preview=n;default_password=default_comment=default_subject=default_email=default_name=hiddenthreads=watchedthreads=enable_hidethreads=enable_threadwatcher=enable_report=enable_sage=enable_returntotop=enable_autonoko=enable_fetchreplies=enable_preview=enable_expandimages=enable_expand=enable_quickreplyiframe=enable_quickreply=i;
function init4chan4chrome(b){if(document.forms.length>0){var d=n;if(!b){b=document;d=h;if(enable_threadwatcher&&window.location.href.search("4chan.org")!=-1){var a=document.createElement("div");a.id="threadwatcher";a.style.borderTop="0px none";a.style.borderBottom="1px solid #CCCCCC";a.style.borderLeft="1px solid #CCCCCC";a.style.borderRight="1px solid #CCCCCC";a.innerHTML='<span title="Refresh" style="float: right;cursor: pointer;font-weight: bold;font-size: 1.1em;padding: 1px;" id="refreshthreadwatcher">&nbsp;R&nbsp;</span><div style="text-align: center;cursor: move;padding: 1px;margin-bottom: 0px;" class="postblock">Watched Threads</div><table cellpadding="1" cellspacing="0" id="watchboxtable" style="margin: 3px;"></table>';
a.className="reply";a.style.margin="0";a.style.padding="0";a.style.position="absolute";a.style.left="10";a.style.top="25";insertAfter(a,document.getElementsByTagName("table")[0]);refreshThreadWatcher();document.getElementById("refreshthreadwatcher").addEventListener("click",function(){refreshThreadWatcherCache()},n)}}var c=b.getElementsByTagName("a");for(a=0;a<c.length;a++)if(c[a].innerHTML=="Reply"&&enable_quickreply){var e=c[a].href.match(/.*\/([0-9]+)(?:\.html)?/i);if(e!=i){e=e[1];var f=document.createElement("a");
f.href="#";f.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_quickreply.png")+'" title="Quick Reply">';f.setAttribute("onclick","return false;");f.setAttribute("threadID",e);f.addEventListener("click",function(){for(var l=b.getElementsByTagName("input"),j=0;j<l.length;j++)l[j].name.search(this.getAttribute("threadID"))!=-1&&quickReplyBox(this.getAttribute("threadID"),l[j])},n);c[a].parentNode.innerHTML+='<span id="spacer'+e+'">&nbsp;</span>';var g=b.getElementById("spacer"+e);insertAfter(f,
g)}}else if(c[a].innerHTML=="No."){e=c[a].href.match(/.*\/([0-9]+)(?:\.html)?\#([0-9]+)/i);if(e!=i)if(e[1]==e[2])c[a].name=e[1]}else setExpandImageAttributes(c[a]);delform=document.forms.delform?document.forms[1]:document.body;if(d&&delform){if(enable_autonoko){e=window.location.href.match(/(^.*)\/res\/[0-9]+.*/i);if(e==i)e=window.location.href.match(/(^.*)\//i);if(e!=i)document.forms[0].action+="#return="+encodeURI(e[1])}c=document.getElementsByTagName("div");for(a=0;a<c.length;a++)if(c[a].className==
"postarea"){postarea=c[a].innerHTML;autoFillPostBox(document)}d=delform.childNodes;f="thread"+Math.floor(Math.random()*1E3);var k=i;if(enable_threadwatcher)k=document.createElement("a");lastreply=e=lastnode=i;for(a=0;a<d.length;a++){node=d[a];if(node.nodeName.toLowerCase()!="hr"){if(!node.setAttribute){c=document.createElement("span");insertAfter(c,node);c.appendChild(node);node=c}node.setAttribute("hidethread",f)}if(!e&&node.nodeName.toLowerCase()=="input"&&node.type=="checkbox"){e=node.name;if(enable_hidethreads){c=
document.createElement("a");c.id="threadhider"+e;c.style.textDecoration="none";c.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_retract.png")+'" title="Hide Thread"> ';c.href="#";c.setAttribute("onClick","javascript:return false;");c.setAttribute("threadID",e);c.setAttribute("hidethreadID",f);c.addEventListener("click",function(){hideThread(this.getAttribute("threadID"));for(var l=getElementsByAttribute("hidethread",this.getAttribute("hidethreadID"),n),j=0;j<l.length;j++)l[j].style.display=
"none";document.getElementById("unhide"+this.getAttribute("hidethreadID")).style.display="block"},n);insertAfter(c,node)}if(enable_threadwatcher){k.id="watch"+e;k.style.textDecoration="none";k.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_watch.png")+'" title="Watch Thread"> ';k.href="#";k.setAttribute("onClick","javascript:return false;");k.setAttribute("threadID",e);k.addEventListener("click",function(){var l=window.location.href.match(/.*\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i);
if(l!=i){var j=this.getAttribute("postsubject");if(j=="")j="&nbsp;";var o=this.getAttribute("postname");if(o=="")o="&nbsp;";l=[l[1],this.getAttribute("threadID"),j,o,""];watchThread(l)}},n);insertAfter(k,node)}}if(enable_threadwatcher&&node.className)if(node.className.toLowerCase()=="filetitle")k.setAttribute("postsubject",node.innerText);else node.className.toLowerCase()=="postername"&&k.setAttribute("postname",node.innerText);if(node.nodeName.toLowerCase()=="table"&&!node.getAttribute("align")){if(window.location.href.search("4chan.org")==
-1){c=node.getElementsByTagName("input");for(g=0;g<c.length;g++)c[g].type=="checkbox"&&node.setAttribute("postID",c[g].name)}node.setAttribute("threadID",e);replaceRefLinksWithQuickReply(node,e);setPostAttributes(node);lastreply=node;lastreplyid=node.getAttribute("postID")}if(node.className&&node.className.toLowerCase()=="omittedposts"&&enable_expand){c=document.createElement("a");c.style.textDecoration="none";c.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_expand.png")+'" title="Expand Thread">&nbsp;';
c.href="#";c.setAttribute("onClick","javascript:return false;");c.setAttribute("threadID",e);node.innerHTML='<span id="spacer2'+e+'"></span><span id="omittedposts'+e+'">'+node.innerHTML+"</span>";g=document.getElementById("spacer2"+e);g.insertBefore(c);node.setAttribute("threadID",e);g.setAttribute("threadID",e);g.setAttribute("expanded","false");g.addEventListener("click",function(){var l=document.getElementById("omittedposts"+this.getAttribute("threadID"));if(this.getAttribute("expanded")=="true"){document.getElementById("replies"+
this.getAttribute("threadID")).parentNode.removeChild(document.getElementById("replies"+this.getAttribute("threadID")));this.innerHTML=this.getAttribute("retracthtml");l.innerHTML="Thread No."+this.getAttribute("threadID")+' retracted.<br clear="left">';this.setAttribute("expanded","false")}else{this.setAttribute("retracthtml",this.innerHTML);l.innerHTML="Thread No."+this.getAttribute("threadID")+" expanding...";this.style.textDecoration="none";this.style.color="#000000";this.style.fontWeight="bold";
this.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_expandwait.png")+'" title="Expanding...">&nbsp;';var j=new XMLHttpRequest;j.open("GET","res/"+this.getAttribute("threadID"),h);j.send();j.threadID=this.getAttribute("threadID");j.spacer=this;j.omittedposts=l;j.onreadystatechange=function(){if(j.readyState==4)if(j.status==200){this.spacer.setAttribute("expanded","true");var o=document.createElement("span"),p=document.createElement("span");p.innerHTML=j.responseText;for(var r=this.threadID,
u=this.spacer,v=this.omittedposts,s=p.getElementsByTagName("form")[1].getElementsByTagName("table"),t=[],q=0;q<s.length;q++)t.push(s[q]);o.id="replies"+r;processExpandTables(o,p,r,u,v,t)}else if(j.status==404)this.omittedposts.innerHTML="Thread No."+this.threadID+" has 404'd."}}},n)}if(node.nodeName.toLowerCase()=="hr"&&lastnode&&lastnode.nodeName.toLowerCase()=="br"){if(enable_hidethreads){c=document.createElement("span");c.innerHTML='<a href="#" id="triggerunhide'+f+'"><img border="0" src="'+chrome.extension.getURL("button_expand.png")+
'" title="Un-hide Thread"></a> Thread No.'+e+" is hidden.";c.id="unhide"+f;c.style.display="none";insertAfter(c,lastnode.previousSibling);c=document.getElementById("triggerunhide"+f);c.setAttribute("onClick","javascript:return false;");c.setAttribute("threadID",e);c.setAttribute("hidethreadID",f);c.addEventListener("click",function(){unhideThread(this.getAttribute("threadID"));for(var l=getElementsByAttribute("hidethread",this.getAttribute("hidethreadID"),n),j=0;j<l.length;j++)l[j].style.display=
"block";document.getElementById("unhide"+this.getAttribute("hidethreadID")).style.display="none"},n)}e=i;f="thread"+Math.floor(Math.random()*1E3);k=document.createElement("a")}lastnode=node}c=delform.innerHTML.split('<br clear="left"><hr>');if(!created_op_preview){for(a=0;a<c.length;a++){e=c[a].match(/.*\<input type\=\"checkbox\" name\=\"([0-9]+)\".*/i);if(e!=i){d=document.createElement("table");d.innerHTML=c[a].split("</blockquote>")[0]+"</blockquote>";f=d.innerHTML.split("<hr>");if(f.length>0)d.innerHTML=
f.pop();d.className="4c4c_reply";d.setAttribute("postID",e[1]);d.setAttribute("op","true");d.style.display="none";delform.appendChild(d)}}created_op_preview=h}if(enable_fetchreplies){e=window.location.href.match(/.*\/res\/[0-9]+.*/i);if(e!=i)if(delform.getAttribute("has404d")==i){delform.setAttribute("has404d","false");setTimeout(fetchLatestPosts,1E4)}enable_fetchreplies=n}replaceRefLinksWithQuickReply(b,i);if(enable_hidethreads){e=window.location.href.match(/.*\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i);
if(e!=i)for(a=0;a<hiddenthreads.length;a++)if(hiddenthreads[a][0]==e[1]){c=document.getElementById("threadhider"+hiddenthreads[a][1]);d=document.createEvent("MouseEvents");d.initMouseEvent("click",h,h,window,0,0,0,0,0,n,n,n,n,0,i);c.dispatchEvent(d)}}if(enable_returntotop){e=window.location.href.match(/.*\/res\/[0-9]+.*/i);if(window.location.href.search("4chan.org")!=-1&&e&&lastreply){a=document.createElement("table");a.className="reply";a.style.marginTop="1em";a.innerHTML='<tr onclick="self.scrollTo(0,0);" style="cursor: hand;"><td align="left" style="font-size: 2em;">&#x25B2;</td><td align="center" width="100%" style="font-size: 2em;">Return to Top</td><td align="right" style="font-size: 2em;">&#x25B2;</td></tr>';
insertAfter(a,lastreply)}}}}}isdrag=n;function movemouse(b){if(isdrag){dobj.style.left=tx+b.clientX-x;dobj.style.top=ty+b.clientY-y;return n}}
document.onmousedown=function(b){for(var d=b.target;d.tagName.toLowerCase()!="html"&&!(d.className=="postblock"&&d.style.textAlign=="center");)d=d.parentNode;if(d.className=="postblock"&&d.style.textAlign=="center"){isdrag=h;dobj=d.parentNode;tx=parseInt(dobj.style.left+0,10);ty=parseInt(dobj.style.top+0,10);x=b.clientX;y=b.clientY;document.onmousemove=movemouse;return n}};document.onmouseup=function(){isdrag=n};
if(document.forms.length==0){m=window.location.href.match(/http\:\/\/.*\.4chan\.org\/.*\#return\=(.*)/i);if(m!=i)if(document.body.innerHTML.search("<!-- thread:")>-1&&document.body.innerHTML.search("<!-- thread:")<500){m2=document.body.innerHTML.match(/\.*<\!-- thread\:([0-9]+),no\:([0-9]+) --\>.*/i);if(m2!=i){if(m2[1]==0)m2[1]=m2[2];window.location=decodeURI(m[1])+"/res/"+m2[1]+"#"+m2[2]}}}disable4c4c=n;m=window.location.href.match(/.*\/\/([0-9a-zA-Z]+)\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i);
if(m!=i)if(m[1]=="sys"||m[1]=="dis"||m[2]=="f")disable4c4c=h;
if(!disable4c4c){chrome.extension.sendRequest({reqtype:"get-options"},function(b){enable_quickreply=b.quickreply;enable_quickreplyiframe=b.quickreplyiframe;enable_expand=b.expand;enable_expandimages=b.expandimages;enable_preview=b.preview;enable_fetchreplies=b.fetchreplies;enable_autonoko=b.autonoko;enable_sage=b.sage;enable_report=b.report;enable_threadwatcher=b.threadwatcher;enable_hidethreads=b.hidethreads;watchedthreads=b.watchedthreads;hiddenthreads=b.hiddenthreads;enable_returntotop=b.returntotop;
default_name=b.default_name;default_email=b.default_email;default_subject=b.default_subject;default_comment=b.default_comment;default_password=b.default_password;init4chan4chrome()});chrome.extension.onRequest.addListener(function(b){if(b.reqtype=="expandall"){expand_all_thumbs=h;b=document.getElementsByTagName("a");for(var d=0;d<b.length;d++)if(b[d].getAttribute("expanded")!=i)if(b[d].getAttribute("expanded")=="false"){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",h,h,window,
0,0,0,0,0,n,n,n,n,0,i);b[d].dispatchEvent(a)}}else if(b.reqtype=="visiturl")window.location.href=b.url})};
