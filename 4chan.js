var h=true,j=null,n=false;function insertAfter(b,c){var a=c.parentNode;a.lastchild==c?a.appendChild(b):a.insertBefore(b,c.nextSibling)}
function watchThread(b){chrome.extension.sendRequest({reqtype:"get-watchedthreads"},function(c){watchedthreads=c;c=n;for(var a=0;a<watchedthreads.length;a++)if(watchedthreads[a][0]==b[0]&&watchedthreads[a][1]==b[1])c=h;if(c)alert("Thread No."+b[1]+" is already being watched.");else{watchedthreads.push(b);storeWatchedThreads();alert("Added thread No."+b[1]+" to watch list.")}storeWatchedThreads();refreshThreadWatcher()})}
function unwatchThread(b,c){chrome.extension.sendRequest({reqtype:"get-watchedthreads"},function(a){watchedthreads=a;for(a=0;a<watchedthreads.length;a++)watchedthreads[a][0]==b&&watchedthreads[a][1]==c&&watchedthreads.splice(a,1);storeWatchedThreads();refreshThreadWatcher()})}function storeWatchedThreads(){chrome.extension.sendRequest({reqtype:"set-watchedthreads",watchedthreads:watchedthreads})}
function updateWatchedThreadNote(b,c,a){chrome.extension.sendRequest({reqtype:"get-watchedthreads"},function(d){watchedthreads=d;for(d=0;d<watchedthreads.length;d++)if(watchedthreads[d][0]==c&&watchedthreads[d][1]==a)watchedthreads[d][4]=b.replace('"',"").replace("<","").replace(">","");storeWatchedThreads()})}function refreshThreadWatcherCache(){chrome.extension.sendRequest({reqtype:"get-watchedthreads"},function(b){watchedthreads=b;refreshThreadWatcher()})}
function refreshThreadWatcher(){var b=window.location.href.match(/.*\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i);if(b!=j){var c=b[1];watchboxtable=document.getElementById("watchboxtable");watchboxtable.innerHTML='<tr><td class="postblock" style="border-right: 0px none;">No.</td><td class="postblock" style="border-left: 0px none;border-right: 0px none;">Subject</td><td class="postblock" style="border-left: 0px none;border-right: 0px none;">Author</td><td class="postblock" style="border-left: 0px none;border-right: 0px none;">Note</td><td class="postblock" style="border-left: 0px none;">&nbsp;</td></tr>';
b=[];for(var a=0;a<watchedthreads.length;a++)watchedthreads[a][0]==c&&b.push(watchedthreads[a]);if(b.length==0){c=document.createElement("tr");c.innerHTML='<td colspan="5" align="center">No watched threads.</td>';watchboxtable.appendChild(c)}else for(a=0;a<b.length;a++){c=document.createElement("tr");c.innerHTML='<td style="padding-left: 3px;padding-right: 3px;">'+b[a][1]+'</td><td class="filetitle" style="padding-left: 3px;padding-right: 3px;">'+b[a][2]+'</td><td class="postername" style="padding-left: 3px;padding-right: 3px;">'+
b[a][3]+'</td><td style="padding-left: 3px;padding-right: 3px;"><input type="text" placeholder="Enter a note" size="12" value="'+b[a][4]+'" id="note'+b[a][0]+b[a][1]+'"></td><td style="padding-left: 3px;padding-right: 3px;"><small>[<a href="/'+b[a][0]+"/res/"+b[a][1]+'">view</a>] [<a href="#" id="delete'+b[a][0]+b[a][1]+'">delete</a>]</small></td>';watchboxtable.appendChild(c);c=document.getElementById("note"+b[a][0]+b[a][1]);c.setAttribute("board",b[a][0]);c.setAttribute("threadid",b[a][1]);c.onchange=
function(){updateWatchedThreadNote(this.value,this.getAttribute("board"),this.getAttribute("threadid"))};c.onkeyup=function(){updateWatchedThreadNote(this.value,this.getAttribute("board"),this.getAttribute("threadid"))};c=document.getElementById("delete"+b[a][0]+b[a][1]);c.setAttribute("board",b[a][0]);c.setAttribute("threadid",b[a][1]);c.addEventListener("click",function(){window.confirm("Stop watching thread No."+this.getAttribute("threadid")+"?")&&unwatchThread(this.getAttribute("board"),this.getAttribute("threadid"))},
n)}}}
function quickReplyBox(b,c){var a=document.createElement("div"),d="qr"+Math.floor(Math.random()*1E3);a.id=d;a.style.borderTop="0px none";a.style.borderBottom="1px solid #CCCCCC";a.style.borderLeft="1px solid #CCCCCC";a.style.borderRight="1px solid #CCCCCC";a.innerHTML='<span title="Close" style="float: right;cursor: pointer;font-weight: bold;font-size: 1.1em;padding: 1px;" onclick="javascript:var qr=document.getElementById(\''+d+'\');qr.parentNode.removeChild(qr);return false;">&nbsp;X&nbsp;</span><div style="text-align: center;cursor: move;padding: 1px;margin-bottom: 10px;" class="postblock">Quick Reply (#'+b+
")</div>"+postarea;if(enable_quickreplyiframe)a.innerHTML+='<iframe id="'+d+'iframe" src="about:blank" style="display: none;min-width:100px;height:50px;margin:0px;padding:0px;"></iframe>';a.className="reply";a.style.margin="0";a.style.padding="0";a.style.position="absolute";for(var f=c.offsetLeft,e=c.offsetTop,g=c;g.offsetParent;)if(g==document.getElementsByTagName("body")[0])break;else{f+=g.offsetParent.offsetLeft;e+=g.offsetParent.offsetTop;g=g.offsetParent}a.style.left=f;a.style.top=e;f=a.getElementsByTagName("table");
for(e=0;e<f.length;e++)f[e].width=="100%"&&f[e].parentNode.removeChild(f[e]);f=a.getElementsByTagName("div");for(e=0;e<f.length;e++)f[e].className!="postblock"&&f[e].id!="recaptcha_area"&&f[e].id!="recaptcha_image"&&f[e].innerHTML.indexOf("recaptcha")==-1&&f[e].parentNode.removeChild(f[e]);f=a.getElementsByTagName("tr");for(e=0;e<f.length;e++)f[e].innerHTML=='<td></td><td colspan="2">\n</td>'&&f[e].parentNode.removeChild(f[e]);if(enable_quickreplyiframe){a.getElementsByTagName("form")[0].id=d+"form";
if(a.getElementsByTagName("form")[0].action.search("#")!=-1)a.getElementsByTagName("form")[0].action=a.getElementsByTagName("form")[0].action.split("#")[0];f=a.getElementsByTagName("input");for(e=0;e<f.length;e++)if(f[e].value=="Submit"){f[e].setAttribute("submitted","false");f[e].setAttribute("qrbid",d);f[e].addEventListener("click",function(){document.getElementById(this.getAttribute("qrbid")+"iframe").style.display="block";document.getElementById(this.getAttribute("qrbid")+"form").submit()},n)}a.getElementsByTagName("form")[0].setAttribute("target",
d+"iframe")}insertAfter(a,c);firstinput=a.getElementsByTagName("input")[0];d=document.createElement("input");d.name="resto";d.value=b;d.type="hidden";insertAfter(d,firstinput);autoFillPostBox(a);return a}
function replaceRefLinksWithQuickReply(b,c){if(enable_quickreply||enable_report||enable_sage){b||(b=document);for(var a=b.getElementsByTagName("a"),d=0;d<a.length;d++){var f=j,e=c,g=a[d].href.match(/.*quote\(\'([0-9]+)\'\)/i);if(g!=j){f=g[1];if(!e){g=window.location.href.match(/.*\/res\/([0-9]+).*/i);if(g!=j)e=g[1]}if(a[d].innerText.search("X")!=-1)a[d].innerText=f}else if(a[d].className=="quotejs"){g=a[d].href.match(/[.*]?res\/([0-9]+)(?:\.html)?\#q([0-9]+)/i);if(g!=j){e=g[1];f=g[2];if(a[d].innerText.search("X")!=
-1)a[d].innerText=f}}if(enable_quickreply&&f&&e&&a[d].href!="javascript:return false;"){a[d].setAttribute("postID",f);a[d].setAttribute("threadID",e);a[d].setAttribute("thisElement",a[d]);a[d].setAttribute("isQuickReply","true");enable_quickreply&&a[d].addEventListener("click",function(){var i=this.getAttribute("threadID"),l=this.getAttribute("postID");qrb=quickReplyBox(i,this.parentNode);i=qrb.getElementsByTagName("textarea");for(var k=0;k<i.length;k++)i[k].value=i[k].value!=""?">>"+l+"\n\n"+i[k].value:
">>"+l+"\n"},n);a[d].href="javascript:false;"}if(enable_report&&f&&a[d].getAttribute("processed")==j){if(e=document.location.href.match(/.*\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i)){g=document.createElement("a");g.href="javascript:reppop('http://sys.4chan.org/"+e[1]+"/imgboard.php?mode=report&no="+f+"');return false;";g.style.textDecoration="none";g.innerHTML=' <img border="0" src="'+chrome.extension.getURL("button_report.png")+'" title="Report Post">';insertAfter(g,a[d])}a[d].setAttribute("processed",
"true")}if(enable_sage&&a[d].href.toLowerCase()=="mailto:sage"&&a[d].getAttribute("processed")==j){a[d].innerHTML="&nbsp;"+a[d].innerHTML+"&nbsp;";a[d].style.textDecoration="none";a[d].style.background="url('"+chrome.extension.getURL("sage.png")+"')";a[d].style.backgroundRepeat="repeat";a[d].setAttribute("processed","true")}}}}
function setExpandImageAttributes(b){if(enable_expandimages){var c=b.href.match(/.*images\.4chan\.org\/.*\/src\/(.*)/i);if(c==j)c=b.href.match(/.*4chanarchive\.org\/images\/(.*)/i);if(c==j)c=b.href.match(/.*inb4\.im\/.*\/src\/(.*)/i);if(c)if(b.innerHTML.substring(0,4)=="<img"){if(b.getAttribute("expanded")==j){b.setAttribute("expanded","false");b.setAttribute("expandImage",expandImage);b.setAttribute("expandOriginalHTML",b.innerHTML);b.setAttribute("onClick","javascript:return false;");img=b.getElementsByTagName("img")[0];
b.setAttribute("thumbSRC",img.getAttribute("src"));b.setAttribute("thumbWidth",img.getAttribute("width"));b.setAttribute("thumbHeight",img.getAttribute("height"));b.target="_self";b.addEventListener("click",function(a){if(a.which==2)window.open(this.getAttribute("expandImage"),"_blank");else if(a.which==1)if(this.getAttribute("expanded")!="true"){this.innerHTML='<img style="border: 1px dashed black;min-width: '+this.getAttribute("thumbWidth")+"px;min-height: "+this.getAttribute("thumbHeight")+'px;" src="'+
this.getAttribute("expandImage")+'" border="0" align="left" hspace="20">';this.setAttribute("expanded","true")}else{this.innerHTML=this.getAttribute("expandOriginalHTML");this.setAttribute("expanded","false")}},n);if(expand_all_thumbs){c=document.createEvent("MouseEvents");c.initMouseEvent("click",h,h,window,0,0,0,0,0,n,n,n,n,0,j);b.dispatchEvent(c)}}}else expandImage=b.href}}
function setPostAttributes(b,c){for(var a=b.getElementsByTagName("a"),d=0;d<a.length;d++){var f=a[d].href.match(/.*\/[0-9]+(?:\.html)?#([0-9]+)/i);if(f==j)f=a[d].href.match(/\#([0-9]+)/i);if(f!=j)if(a[d].innerHTML=="No."){b.setAttribute("postID",f[1]);b.className="4c4c_reply"}else{if(enable_preview&&a[d].getAttribute("refID")==j)if(a[d].innerHTML.match(/^\&gt\;\&gt\;[0-9]+/i)!=j){a[d].setAttribute("refID",f[1]);a[d].addEventListener("mousemove",function(e){var g=document.getElementById("ref"+this.getAttribute("refID"));
if(!g){g=document.createElement("div");g.id="ref"+this.getAttribute("refID");g.className="reply";g.style.margin="0";g.style.padding="0";g.style.position="absolute";for(var i=window.location.href.search("4chan.org")==-1?document.getElementsByTagName("table"):document.getElementsByClassName("4c4c_reply"),l=0;l<i.length;l++){var k=i[l].getAttribute("postID");if(k&&k==this.getAttribute("refID")){g.innerHTML=i[l].innerHTML;if(i[l].getAttribute("op")=="true"){g.className="postblock";g.innerHTML='<div style="position: absolute;right: 0px;top: 0px;font-size: 1.5em;margin: 0px;padding: 1px;" class="unkfunc">OP</div>'+
g.innerHTML}}}insertAfter(g,this)}g.style.left=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft+25;g.style.top=e.clientY+document.body.scrollTop+document.documentElement.scrollTop+10},n);a[d].addEventListener("mouseout",function(){var e=document.getElementById("ref"+this.getAttribute("refID"));e&&e.parentNode.removeChild(e)},n)}}else c&&setExpandImageAttributes(a[d])}}
function processExpandTables(b,c,a,d,f,e,g){g||(g=[]);if(e&&e.length>0){var i=e.shift();if(i.width!="100%"&&i.cellpadding!="0"&&i.align!="right")b.innerHTML+="<table>"+i.innerHTML+"</table>"}if(e&&e.length>0)setTimeout(processExpandTables,1,b,c,a,d,f,e,g);else{c.style.display="none";c=document.getElementsByClassName("4c4c_reply");for(e=0;e<c.length;e++)if(c[e].getAttribute("threadID")==a)c[e].style.display="none";c=b.getElementsByTagName("table");for(e=0;e<c.length;e++)setPostAttributes(c[e],h);replaceRefLinksWithQuickReply(b,
a);c=document.getElementsByTagName("span");for(e=0;e<c.length;e++)c[e].id=="omittedposts"+a&&insertAfter(b,c[e]);d.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_retract.png")+'" title="Retract">&nbsp;';f.innerHTML="Thread No."+a+" expanded."}}
function autoFillPostBox(b){b||(b=document);if(default_name==j||default_email==j||default_subject==j||default_comment==j||default_password==j)setTimeout(autoFillPostBox,10,b);else{for(var c=b.getElementsByTagName("input"),a=0;a<c.length;a++)if(c[a].name=="name"){if(default_name!="")c[a].value=default_name}else if(c[a].name=="email"){if(default_email!="")c[a].value=default_email}else if(c[a].name=="sub"){if(default_subject!="")c[a].value=default_subject}else if(c[a].name=="pwd")if(default_password!=
"")c[a].value=default_password;c=b.getElementsByTagName("textarea");for(a=0;a<c.length;a++)if(c[a].name=="com")if(c[a].value==""&&default_comment!="")c[a].value=default_comment}}
function processLatestRepliesLoop(b,c){var a=n;if(b&&b.length>0){a=b.shift();if(a.getAttribute("special")!=j||a.getAttribute("postID")>lastreply.getAttribute("postID")){replaceRefLinksWithQuickReply(a);insertAfter(a,lastreply);lastreply=a;lastreplyid=lastreply.getAttribute("postID")}}if(b&&b.length>0)setTimeout(processLatestRepliesLoop,10,b,c);else last_modified=c}
function fetchLatestPosts(){var b=n,c=window.location.href.match(/.*\/res\/([0-9]+).*/i);if(c!=j)b=c[1];if(b){var a=new XMLHttpRequest;a.open("HEAD",b,h);a.send();a.threadID=b;a.onreadystatechange=function(){if(a.readyState==4)if(last_modified&&(a.status==404||a.getResponseHeader("Last-Modified")!=last_modified)){var d=new XMLHttpRequest;d.open("GET",a.threadID,h);d.send();d.threadID=a.threadID;d.onreadystatechange=function(){var f=[];f.length=0;if(d.status==404){if(document.forms[1].getAttribute("has404d")==
"false"){document.forms[1].setAttribute("has404d","true");var e=document.createElement("span");e.setAttribute("special","true");e.innerHTML="This thread has 404'd";e.style.color="red";e.style.fontSize="2.0em";f.push(e)}}else if(d.status==200){e=document.createElement("span");e.innerHTML=d.responseText;e=e.getElementsByTagName("table");for(var g=0;g<e.length;g++){setPostAttributes(e[g],h);e[g].getAttribute("postID")!=j&&e[g].getAttribute("postID")>lastreplyid&&f.push(e[g])}}if(f.length>0){last_modified=
n;e=d.getResponseHeader("Last-Modified");if(!lastreply){g=document.forms[1].getElementsByClassName("4c4c_reply");for(var i=0;i<g.length;i++)if(g[i].getAttribute("postID")!=j&&g[i].getAttribute("op")==j){lastreply=g[i];lastreplyid=lastreply.getAttribute("postID")}}lastreply||(lastreply=document.forms[1].getElementsByTagName("blockquote")[0]);processLatestRepliesLoop(f,e)}}}};document.forms[1].getAttribute("has404d")=="false"&&setTimeout(fetchLatestPosts,1E4)}}threads=[];delform=j;lastreply=n;
lastreplyid=0;last_modified=document.lastModified;expand_all_thumbs=created_op_preview=n;default_password=default_comment=default_subject=default_email=default_name=watchedthreads=enable_threadwatcher=enable_report=enable_sage=enable_returntotop=enable_autonoko=enable_fetchreplies=enable_preview=enable_expandimages=enable_expand=enable_quickreplyiframe=enable_quickreply=j;chrome.extension.sendRequest({reqtype:"get-quickreply"},function(b){enable_quickreply=b});
chrome.extension.sendRequest({reqtype:"get-quickreplyiframe"},function(b){enable_quickreplyiframe=b});chrome.extension.sendRequest({reqtype:"get-expand"},function(b){enable_expand=b});chrome.extension.sendRequest({reqtype:"get-expandimages"},function(b){enable_expandimages=b});chrome.extension.sendRequest({reqtype:"get-preview"},function(b){enable_preview=b});chrome.extension.sendRequest({reqtype:"get-fetchreplies"},function(b){enable_fetchreplies=b});
chrome.extension.sendRequest({reqtype:"get-autonoko"},function(b){enable_autonoko=b});chrome.extension.sendRequest({reqtype:"get-sage"},function(b){enable_sage=b});chrome.extension.sendRequest({reqtype:"get-report"},function(b){enable_report=b});chrome.extension.sendRequest({reqtype:"get-threadwatcher"},function(b){enable_threadwatcher=b});chrome.extension.sendRequest({reqtype:"get-watchedthreads"},function(b){watchedthreads=b});
chrome.extension.sendRequest({reqtype:"get-returntotop"},function(b){enable_returntotop=b});chrome.extension.sendRequest({reqtype:"get-default-name"},function(b){default_name=b});chrome.extension.sendRequest({reqtype:"get-default-email"},function(b){default_email=b});chrome.extension.sendRequest({reqtype:"get-default-subject"},function(b){default_subject=b});chrome.extension.sendRequest({reqtype:"get-default-comment"},function(b){default_comment=b});
chrome.extension.sendRequest({reqtype:"get-default-password"},function(b){default_password=b});
chrome.extension.onRequest.addListener(function(b){if(b.reqtype=="expandall"){expand_all_thumbs=h;b=document.getElementsByTagName("a");for(var c=0;c<b.length;c++)if(b[c].getAttribute("expanded")!=j)if(b[c].getAttribute("expanded")=="false"){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",h,h,window,0,0,0,0,0,n,n,n,n,0,j);b[c].dispatchEvent(a)}}else if(b.reqtype=="visiturl")window.location.href=b.url});
function init4chan4chrome(b){if(enable_quickreply==j||enable_quickreplyiframe==j||enable_expand==j||enable_expandimages==j||enable_preview==j||enable_fetchreplies==j||enable_autonoko==j||enable_sage==j||enable_report==j||enable_threadwatcher==j||watchedthreads==j||enable_returntotop==j)setTimeout(init4chan4chrome,10);else if(document.forms.length>0){var c=n;if(!b){b=document;c=h;if(enable_threadwatcher&&window.location.href.search("4chan.org")!=-1){var a=document.createElement("div");a.id="threadwatcher";
a.style.borderTop="0px none";a.style.borderBottom="1px solid #CCCCCC";a.style.borderLeft="1px solid #CCCCCC";a.style.borderRight="1px solid #CCCCCC";a.innerHTML='<span title="Refresh" style="float: right;cursor: pointer;font-weight: bold;font-size: 1.1em;padding: 1px;" id="refreshthreadwatcher">&nbsp;R&nbsp;</span><div style="text-align: center;cursor: move;padding: 1px;margin-bottom: 0px;" class="postblock">Watched Threads</div><table cellpadding="1" cellspacing="0" id="watchboxtable" style="margin: 3px;"></table>';
a.className="reply";a.style.margin="0";a.style.padding="0";a.style.position="absolute";a.style.left="10";a.style.top="25";insertAfter(a,document.getElementsByTagName("table")[0]);refreshThreadWatcher();document.getElementById("refreshthreadwatcher").addEventListener("click",function(){refreshThreadWatcherCache()},n)}}var d=b.getElementsByTagName("a");for(a=0;a<d.length;a++)if(d[a].innerHTML=="Reply"&&enable_quickreply){var f=d[a].href.match(/.*\/([0-9]+)(?:\.html)?/i);if(f!=j){f=f[1];var e=document.createElement("a");
e.href="#";e.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_quickreply.png")+'" title="Quick Reply">';e.setAttribute("onclick","return false;");e.setAttribute("threadID",f);e.addEventListener("click",function(){for(var l=b.getElementsByTagName("input"),k=0;k<l.length;k++)l[k].name.search(this.getAttribute("threadID"))!=-1&&quickReplyBox(this.getAttribute("threadID"),l[k])},n);d[a].parentNode.innerHTML+='<span id="spacer'+f+'">&nbsp;</span>';var g=b.getElementById("spacer"+f);insertAfter(e,
g)}}else if(d[a].innerHTML=="No."){f=d[a].href.match(/.*\/([0-9]+)(?:\.html)?\#([0-9]+)/i);if(f!=j)if(f[1]==f[2])d[a].name=f[1]}else setExpandImageAttributes(d[a]);delform=document.forms.delform?document.forms[1]:document.body;if(c&&delform){if(enable_autonoko){f=window.location.href.match(/(^.*)\/res\/[0-9]+.*/i);if(f==j)f=window.location.href.match(/(^.*)\//i);if(f!=j)document.forms[0].action+="#return="+encodeURI(f[1])}d=document.getElementsByTagName("div");for(a=0;a<d.length;a++)if(d[a].className==
"postarea"){postarea=d[a].innerHTML;autoFillPostBox(document)}c=delform.childNodes;lastreply=f=lastnode=j;for(a=0;a<c.length;a++){node=c[a];if(!f&&node.nodeName.toLowerCase()=="input"&&node.type=="checkbox"){f=node.name;if(enable_threadwatcher){var i=document.createElement("a");i.id="watch"+f;i.style.textDecoration="none";i.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_watch.png")+'" title="Watch Thread"> ';i.href="#";i.setAttribute("onClick","javascript:return false;");i.setAttribute("threadID",
f);i.addEventListener("click",function(){var l=window.location.href.match(/.*\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i);if(l!=j){var k=this.getAttribute("postsubject");if(k=="")k="&nbsp;";var o=this.getAttribute("postname");if(o=="")o="&nbsp;";l=[l[1],this.getAttribute("threadID"),k,o,""];watchThread(l)}},n);insertAfter(i,node)}}if(enable_threadwatcher&&node.className)if(node.className.toLowerCase()=="filetitle")i.setAttribute("postsubject",node.innerText);else node.className.toLowerCase()=="postername"&&
i.setAttribute("postname",node.innerText);if(node.nodeName.toLowerCase()=="table"&&!node.getAttribute("align")){if(window.location.href.search("4chan.org")==-1){d=node.getElementsByTagName("input");for(g=0;g<d.length;g++)d[g].type=="checkbox"&&node.setAttribute("postID",d[g].name)}node.setAttribute("threadID",f);replaceRefLinksWithQuickReply(node,f);setPostAttributes(node);lastreply=node;lastreplyid=node.getAttribute("postID")}if(node.className&&node.className.toLowerCase()=="omittedposts"&&enable_expand){d=
document.createElement("a");d.style.textDecoration="none";d.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_expand.png")+'" title="Expand Thread">&nbsp;';d.href="#";d.setAttribute("onClick","javascript:return false;");d.setAttribute("threadID",f);node.innerHTML='<span id="spacer2'+f+'"></span><span id="omittedposts'+f+'">'+node.innerHTML+"</span>";g=document.getElementById("spacer2"+f);g.insertBefore(d);node.setAttribute("threadID",f);g.setAttribute("threadID",f);g.setAttribute("expanded",
"false");g.addEventListener("click",function(){var l=document.getElementById("omittedposts"+this.getAttribute("threadID"));if(this.getAttribute("expanded")=="true"){document.getElementById("replies"+this.getAttribute("threadID")).parentNode.removeChild(document.getElementById("replies"+this.getAttribute("threadID")));this.innerHTML=this.getAttribute("retracthtml");l.innerHTML="Thread No."+this.getAttribute("threadID")+' retracted.<br clear="left">';this.setAttribute("expanded","false")}else{this.setAttribute("retracthtml",
this.innerHTML);l.innerHTML="Thread No."+this.getAttribute("threadID")+" expanding...";this.style.textDecoration="none";this.style.color="#000000";this.style.fontWeight="bold";this.innerHTML='<img border="0" src="'+chrome.extension.getURL("button_expandwait.png")+'" title="Expanding...">&nbsp;';var k=new XMLHttpRequest;k.open("GET","res/"+this.getAttribute("threadID"),h);k.send();k.threadID=this.getAttribute("threadID");k.spacer=this;k.omittedposts=l;k.onreadystatechange=function(){if(k.readyState==
4)if(k.status==200){this.spacer.setAttribute("expanded","true");var o=document.createElement("span"),p=document.createElement("span");p.innerHTML=k.responseText;for(var r=this.threadID,u=this.spacer,v=this.omittedposts,s=p.getElementsByTagName("form")[1].getElementsByTagName("table"),t=[],q=0;q<s.length;q++)t.push(s[q]);o.id="replies"+r;processExpandTables(o,p,r,u,v,t)}else if(k.status==404)this.omittedposts.innerHTML="Thread No."+this.threadID+" has 404'd."}}},n)}if(node.nodeName.toLowerCase()==
"hr"&&lastnode&&lastnode.nodeName.toLowerCase()=="br")f=j;lastnode=node}d=delform.innerHTML.split('<br clear="left"><hr>');if(!created_op_preview){for(a=0;a<d.length;a++){f=d[a].match(/.*\<input type\=\"checkbox\" name\=\"([0-9]+)\".*/i);if(f!=j){i=document.createElement("table");i.innerHTML=d[a].split("</blockquote>")[0]+"</blockquote>";c=i.innerHTML.split("<hr>");if(c.length>0)i.innerHTML=c.pop();i.className="4c4c_reply";i.setAttribute("postID",f[1]);i.setAttribute("op","true");i.style.display=
"none";delform.appendChild(i)}}created_op_preview=h}if(enable_fetchreplies){f=window.location.href.match(/.*\/res\/[0-9]+.*/i);if(f!=j)if(delform.getAttribute("has404d")==j){delform.setAttribute("has404d","false");setTimeout(fetchLatestPosts,1E4)}enable_fetchreplies=n}replaceRefLinksWithQuickReply(b,j);if(enable_returntotop){f=window.location.href.match(/.*\/res\/[0-9]+.*/i);if(window.location.href.search("4chan.org")!=-1&&f&&lastreply){a=document.createElement("table");a.className="reply";a.style.marginTop=
"1em";a.innerHTML='<tr onclick="self.scrollTo(0,0);" style="cursor: hand;"><td align="left" style="font-size: 2em;">&#x25B2;</td><td align="center" width="100%" style="font-size: 2em;">Return to Top</td><td align="right" style="font-size: 2em;">&#x25B2;</td></tr>';insertAfter(a,lastreply)}}}}}isdrag=n;function movemouse(b){if(isdrag){dobj.style.left=tx+b.clientX-x;dobj.style.top=ty+b.clientY-y;return n}}
document.onmousedown=function(b){for(var c=b.target;c.tagName.toLowerCase()!="html"&&!(c.className=="postblock"&&c.style.textAlign=="center");)c=c.parentNode;if(c.className=="postblock"&&c.style.textAlign=="center"){isdrag=h;dobj=c.parentNode;tx=parseInt(dobj.style.left+0,10);ty=parseInt(dobj.style.top+0,10);x=b.clientX;y=b.clientY;document.onmousemove=movemouse;return n}};document.onmouseup=function(){isdrag=n};
if(document.forms.length==0){m=window.location.href.match(/http\:\/\/.*\.4chan\.org\/.*\#return\=(.*)/i);if(m!=j)if(document.body.innerHTML.search("<!-- thread:")>-1&&document.body.innerHTML.search("<!-- thread:")<500){m2=document.body.innerHTML.match(/\.*<\!-- thread\:([0-9]+),no\:([0-9]+) --\>.*/i);if(m2!=j){if(m2[1]==0)m2[1]=m2[2];window.location=decodeURI(m[1])+"/res/"+m2[1]+"#"+m2[2]}}}disable4c4c=n;m=window.location.href.match(/.*\/\/([0-9a-zA-Z]+)\.4chan\.org\/([0-9a-zA-Z]+)\/.*/i);
if(m!=j)if(m[1]=="sys"||m[1]=="dis"||m[2]=="f")disable4c4c=h;disable4c4c||setTimeout(init4chan4chrome,10);
